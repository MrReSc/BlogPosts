<h1 id="pfsene-als-einarmiger-router">pfSene als einarmiger Router</h1>
<p>Das hier ist ein kurzer Erfahrungsbericht über <a target="_blank" rel="noopener" href="https://de.wikipedia.org/wiki/PfSense">pfSense</a> keine Installationsanleitung.</p>
<p>Seit knapp einem Jahr haben wir in unsrem Haus drei Unifi Access Points im Einsatz. Diese funktionieren vorbildlich. Zusätzlich dazu, hatte ich als Router ein UniFi Security Gateway (USG). Alles zusammen kann wunderbar über den selbst gehosteten Unifi Controller verwaltet werden. Wirklich gut zu einem bezahlbaren Preis. Aber leider hatte das USG immer wieder Probleme bereitet. Nach ein bis zwei Betriebstagen gab es immer wieder Fehlfunktionen. Zum Beispiel funktionierte plötzlich die Port-Weiterleitung nicht mehr oder es gab ein Speicherüberlauf und die Netzwerkverbindungen vielen komplett aus. Das Gerät hatte im Betrieb auch immer eine sehr hohe Temperatur. Nur das aus- und wieder einstecken schaffte Abhilfe. Ich hatte diese Fehler bei zwei Geräten und bin auch nicht der einzige. Bedauerlicherweise ist es wie immer - die Firma scheint sich nicht mehr für dieses altes Gerät zu interessieren und die Probleme werden nicht mehr behoben. Und hier kommt nun pfSense ins Spiel.</p>
<p><img src="PfSense_logo.png" /></p>
<p>Auf der Suche nach einer Alternative habe ich mir <a target="_blank" rel="noopener" href="https://de.wikipedia.org/wiki/PfSense">pfSense</a> ein wenig genauer angeschaut. pfSense ist eine Firewall-Distribution auf der Basis des Betriebssystems <a target="_blank" rel="noopener" href="https://de.wikipedia.org/wiki/FreeBSD">FreeBSD</a> und des Paketfilters <a target="_blank" rel="noopener" href="https://de.wikipedia.org/wiki/Pf_(Paketfilter)">pf</a>. Die Software steht unter der Apache-Lizenz v2. Es gibt die pfSense Community Edition (CE), die gratis ist, sowie die pfSense Plus als Bezahlversion mit offiziellem Support für Geschäftskunden.</p>
<p>Die minimalen Hardwareanforderungen sehen wie folgt aus:</p>
<ul>
<li>64-bit amd64 (x86-64)-kompatible CPU</li>
<li>1 GB Arbeitsspeicher</li>
<li>8 GB Festplatten-, SSD oder SD-Karten-Speicher</li>
<li>einer oder mehrere Netzwerkanschlüsse</li>
<li>USB-Speicher oder DVD-ROM Laufwerk zur Installation</li>
</ul>
<p>Als ich nach einem Weg suchte, pfSense einmal auszuprobieren, stiess ich auf den Begriff “one-armed router” oder <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Router_on_a_stick">“router on a stick”</a>. Es handelt sich um eine Methode des Inter-VLAN-Routing (virtuelle lokale Netzwerke), bei der ein Router über ein einziges Kabel mit einem Switch verbunden ist. Da ich im Keller noch einen Intel NUC <a target="_blank" rel="noopener" href="https://ark.intel.com/content/www/de/de/ark/products/76978/intel-nuc-kit-d34010wyk.html">D34010WYK</a> aus dem Jahr 2013 hatte und mein Switch VLAN’s unterstützt, schien mir das eine gute Möglichkeit.</p>
<p>Die Installation von pfSense via USB-Stick ist ziemlich einfach. Auch die Konfiguration des LAN und WAN Interface ist ein Kinderspiel. Ich habe mich an dieser <a target="_blank" rel="noopener" href="https://thunderysteak.github.io/pfsense-single-nic-vlans">Anleitung</a> orientiert. Nach der Installation und Konfiguration meines Switch begrüsste mich das Webinterface von pfSense und die Internetverbindung funktionierte bereits.</p>
<p><img src="dashboard.png" /></p>
<p>Damit meine Nextcloud auch im lokalen Netzwerk über die Domain und den weitergeleiteten Port erreichbar ist, musste ich <a target="_blank" rel="noopener" href="https://docs.netgate.com/pfsense/en/latest/recipes/port-forwards-from-local-networks.html">NAT Reflection</a> aktivieren.</p>
<p>Als Adblocker habe ich <a target="_blank" rel="noopener" href="https://docs.netgate.com/pfsense/en/latest/packages/pfblocker.html?highlight=pfblock">pfBlocker-NG</a> installiert und konfiguriert. Den OpenVPN Server einzurichten, war schon etwas anspruchsvoller. Aber mit der Hilfe dieser <a target="_blank" rel="noopener" href="https://technium.ch/pfsense-openvpn-server-und-user-einrichten-tutorial/">Anleitung</a> hat es eigentlich auf Anhieb geklappt.</p>
<p>Zu Testzwecken habe ich noch <a target="_blank" rel="noopener" href="https://de.wikipedia.org/wiki/Snort">Snort</a> installiert und mit der Hilfe der <a target="_blank" rel="noopener" href="https://docs.netgate.com/pfsense/en/latest/packages/snort/setup.html">Doku</a> konfiguriert. Snort ist ein freies <a target="_blank" rel="noopener" href="https://de.wikipedia.org/wiki/Intrusion_Detection_System">IDS</a>/<a target="_blank" rel="noopener" href="https://de.wikipedia.org/wiki/Intrusion_Prevention_System">IPS</a> System. Es dient der Angriffserkennung und Abwehr auf das Netzwerk. Zugegeben, meine Netzwerkkenntnisse reichen nicht aus, um Snort vollumfänglich bedienen zu können oder viele der Regeln zu verstehen. Allerdings sind die Grundeinstellungen sehr gut. Ich musste bis jetzt ca. 10 Regeln unterdrücken, damit unsere normale Internetnutzung ohne Probleme funktioniert. Es ist sehr interessant zu sehen, dass permanent an meine Internt Haustüre(n) gehämmert wird.</p>
<p>Die Performance des einarmigen Routers stellt sich als sehr gut heraus. Wenn ich nicht gleichzeitig grosse Daten im LAN verschiebe, kann über die Full-duplex Ethernet Verbindung mein Gigabit Glasfaseranschluss voll ausgenutzt werden. Der Stromverbrauch des alten Intel NUC liegt zwischen 5 W und 10 W. Und das wichtigste: Es läuft absolut stabil!</p>
<p>Vorerst ist das für mich eine gute Lösung und ein adäquater Ersatz für das USG. pfSense ist eine mächtige Firewall mit sehr vielen Möglichkeiten. Meine Fachkenntnisse sind weit davon entfernt, diese nutzen zu können. Ich würde sagen, es besteht die Gefahr, dass ich Fehlkonfigurationen vornehme. Dies birgt natürlich auch Gefahren. Ich habe mich meist an die <a target="_blank" rel="noopener" href="https://docs.netgate.com/">offiziellen Dokumentationen</a> gehalten und so wenig wie möglich an den Standardeinstellungen geändert. Somit bin ich zuversichtlich, und freue mich über eine stabile, kostengünstige und vor allem freie Lösung.</p>
